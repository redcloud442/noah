generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["user_schema", "product_schema", "order_schema", "category_schema", "payment_schema", "public"]
}

model user_table {
  user_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_name String
  user_email String @unique
  user_created_at DateTime @default(now())  @db.Timestamptz(3)
  user_updated_at DateTime? @updatedAt  @db.Timestamptz(3)
  user_profile_picture String?
  user_group_id String @db.Uuid @default("79b0d3b5-f110-4874-a9b8-72777fd4257a")

  user_address_table user_address_table[]
  cart_table cart_table[]
  user_group user_group_table @relation(fields: [user_group_id], references: [user_group_id], onDelete: Cascade)
  @@schema("user_schema")
}

model user_group_table {
  user_group_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_group_name String
  user_group_description String
  user_group_created_at DateTime @default(now())  @db.Timestamptz(3)
  user_group_updated_at DateTime? @updatedAt  @db.Timestamptz(3)

  user_table user_table[]
  @@schema("user_schema")
}

model user_address_table {
  user_address_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_address_name String
  user_address_phone String
  user_address_address String
  user_address_city String
  user_address_state String
  user_address_postal_code String
  user_address_created_at DateTime @default(now())  @db.Timestamptz(3)
  user_address_updated_at DateTime? @updatedAt  @db.Timestamptz(3)
  user_address_user_id String @db.Uuid

  user_address_user user_table @relation(fields: [user_address_user_id], references: [user_id], onDelete: Cascade)
  @@schema("user_schema")
}

model cart_table {
  cart_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  cart_user_id String @db.Uuid
  cart_product_variant_id String @db.Uuid
  cart_quantity Int
  cart_created_at DateTime @default(now())  @db.Timestamptz(3)
  cart_updated_at DateTime? @updatedAt  @db.Timestamptz(3)

  cart_user user_table @relation(fields: [cart_user_id], references: [user_id], onDelete: Cascade)
  cart_product_variant product_variant_table @relation(fields: [cart_product_variant_id], references: [product_variant_id], onDelete: Cascade)
  @@schema("order_schema")
}

model product_table {
  product_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_name String
  product_description String
  product_price Int
  product_sale_percentage Int @default(0)
  product_created_at DateTime @default(now())  @db.Timestamptz(3)
  product_updated_at DateTime? @updatedAt  @db.Timestamptz(3)
  product_category_id String @db.Uuid

  product_category product_category_table @relation(fields: [product_category_id], references: [product_category_id], onDelete: Cascade)
  product_variants product_variant_table[]
  @@schema("product_schema")
}

model product_category_table {
  product_category_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_category_name String
  product_category_description String
  product_category_created_at DateTime @default(now())  @db.Timestamptz(3)
  product_category_updated_at DateTime? @updatedAt  @db.Timestamptz(3)

  products product_table[]
  @@schema("product_schema")
}

model product_variant_table {
  product_variant_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_variant_product_id String @db.Uuid
  product_variant_color String
  product_variant_size String
  product_variant_slug String?
  product_variant_quantity Int @default(0)  // Tracks available inventory

  product_variant_product product_table @relation(fields: [product_variant_product_id], references: [product_id], onDelete: Cascade)
  cart_items cart_table[]
  variant_sample_images variant_sample_image_table[]
  @@schema("product_schema")
}

model variant_sample_image_table {
  variant_sample_image_id String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  variant_sample_image_product_variant_id String @db.Uuid
  variant_sample_image_image_url String
  variant_sample_image_created_at DateTime @default(now())  @db.Timestamptz(3)

  variant_sample_image_product_variant product_variant_table @relation(fields: [variant_sample_image_product_variant_id], references: [product_variant_id], onDelete: Cascade)
  @@schema("product_schema")
}
